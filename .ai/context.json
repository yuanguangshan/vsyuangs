[
  {
    "type": "file",
    "path": "compile.sh",
    "content": "#!/bin/bash\n\n# Yuangs VSCode Extension ä¸€é”®ç¼–è¯‘å’Œæ‰“åŒ…è„šæœ¬\n# è‡ªåŠ¨æŸ¥æ‰¾ npm å¹¶æ‰§è¡Œå®Œæ•´çš„æ„å»ºå’Œæ‰“åŒ…æµç¨‹\n\nset -e\n\necho \"ğŸ” æ­£åœ¨æŸ¥æ‰¾ Node.js å’Œ npm...\"\n\n# å°è¯•å¤šç§æ–¹å¼æ‰¾åˆ° node å’Œ npm\nNODE_BIN_DIR=\"\"\n\n# æ–¹æ³•1: æ£€æŸ¥å¸¸è§è·¯å¾„\nfor base_path in \\\n    \"/usr/local/bin\" \\\n    \"/opt/homebrew/bin\" \\\n    \"$HOME/.nvm/versions/node/*/bin\" \\\n    \"$HOME/.volta/bin\" \\\n    \"$HOME/.fnm/node-versions/*/installation/bin\"\ndo\n    # å±•å¼€é€šé…ç¬¦\n    for path in $base_path; do\n        if [ -d \"$path\" ] && [ -f \"$path/node\" ] && [ -f \"$path/npm\" ]; then\n            NODE_BIN_DIR=\"$path\"\n            break 2\n        fi\n    done\ndone\n\n# æ–¹æ³•2: ä½¿ç”¨ which\nif [ -z \"$NODE_BIN_DIR\" ]; then\n    NODE_PATH=$(which node 2>/dev/null || echo \"\")\n    if [ -n \"$NODE_PATH\" ]; then\n        NODE_BIN_DIR=$(dirname \"$NODE_PATH\")\n    fi\nfi\n\nif [ -z \"$NODE_BIN_DIR\" ]; then\n    echo \"âŒ é”™è¯¯: æ‰¾ä¸åˆ° Node.js å’Œ npm\"\n    echo \"è¯·ç¡®ä¿å·²å®‰è£… Node.js å’Œ npm\"\n    echo \"\"\n    echo \"å®‰è£…æ–¹å¼:\"\n    echo \"  - Homebrew: brew install node\"\n    echo \"  - NVM: https://github.com/nvm-sh/nvm\"\n    echo \"  - å®˜ç½‘: https://nodejs.org/\"\n    exit 1\nfi\n\n# è®¾ç½® PATH\nexport PATH=\"$NODE_BIN_DIR:$PATH\"\n\necho \"âœ… æ‰¾åˆ° Node.js: $NODE_BIN_DIR/node\"\necho \"âœ… æ‰¾åˆ° npm: $NODE_BIN_DIR/npm\"\necho \"\"\n\n# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯\necho \"ğŸ“¦ Node.js ç‰ˆæœ¬:\"\nnode --version\necho \"\"\necho \"ğŸ“¦ npm ç‰ˆæœ¬:\"\nnpm --version\necho \"\"\n\n# æ£€æŸ¥ vsce æ˜¯å¦å·²å®‰è£…\necho \"\"\necho \"ğŸ” æ£€æŸ¥ vsce (VSCE æ‰“åŒ…å·¥å…·)...\"\nif ! command -v vsce &> /dev/null; then\n    echo \"âš ï¸  vsce æœªæ‰¾åˆ°ï¼Œæ­£åœ¨å°è¯•å®‰è£…...\"\n    npm install -g @vscode/vsce\n    if [ $? -ne 0 ]; then\n        echo \"âŒ å®‰è£… vsce å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å®‰è£…: npm install -g @vscode/vsce\"\n        exit 1\n    fi\nfi\necho \"âœ… vsce å·²å®‰è£…: $(which vsce)\"\n\n# è¿›å…¥é¡¹ç›®ç›®å½•\ncd \"$(dirname \"$0\")\"\n\n# è·å–ç”¨æˆ·è¾“å…¥å‚æ•°\nBUILD_ONLY=false\nPACKAGE_ONLY=false\nCLEAN_BUILD=false\n\nwhile [[ $# -gt 0 ]]; do\n    case $1 in\n        --build-only)\n            BUILD_ONLY=true\n            shift\n            ;;\n        --package-only)\n            PACKAGE_ONLY=true\n            shift\n            ;;\n        --clean)\n            CLEAN_BUILD=true\n            shift\n            ;;\n        *)\n            echo \"æœªçŸ¥å‚æ•°: $1\"\n            echo \"ç”¨æ³•: $0 [--build-only | --package-only | --clean]\"\n            exit 1\n            ;;\n    esac\ndone\n\necho \"\"\necho \"ğŸš€ å¼€å§‹æ„å»ºå’Œæ‰“åŒ…æµç¨‹...\"\necho \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\necho \"\"\n\nif [ \"$CLEAN_BUILD\" = true ]; then\n    echo \"ğŸ§¹ æ­¥éª¤ 1: æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶...\"\n    echo \"   åˆ é™¤ dist/ å’Œ out/ ç›®å½•ä»¥ç¡®ä¿å¹²å‡€çš„æ„å»ºç¯å¢ƒ\"\n    rm -rf dist/\n    rm -rf out/\n    echo \"   âœ… æ¸…ç†å®Œæˆ\"\n    echo \"\"\nfi\n\nif [ \"$PACKAGE_ONLY\" = false ]; then\n    echo \"ğŸ—ï¸  æ­¥éª¤ 2: æ‰§è¡Œå®Œæ•´æ„å»ºæµç¨‹\"\n    echo \"   æ­¤æ­¥éª¤å°†ç¼–è¯‘æ‰€æœ‰æºä»£ç å¹¶åˆ›å»ºç”Ÿäº§å°±ç»ªçš„æ†ç»‘åŒ…\"\n    echo \"\"\n\n    echo \"   â”œâ”€â”€ å­æ­¥éª¤ 2.1: ç¼–è¯‘ AssemblyScript ä»£ç ...\"\n    echo \"         - ç¼–è¯‘ src/engine/agent/governance/sandbox/core.as.ts ä¸º debug å’Œ release ç‰ˆæœ¬\"\n    echo \"         - ç”Ÿæˆ WebAssembly æ¨¡å—ä¾›æ²™ç®±ç¯å¢ƒä½¿ç”¨\"\n    npm run asbuild\n    echo \"         âœ… AssemblyScript ç¼–è¯‘å®Œæˆ\"\n    echo \"\"\n\n    echo \"   â”œâ”€â”€ å­æ­¥éª¤ 2.2: æ†ç»‘å’Œä¼˜åŒ–ä»£ç ...\"\n    echo \"         - ä½¿ç”¨ Webpack å°†æ‰€æœ‰æ¨¡å—æ†ç»‘æˆå•ä¸ª extension.js æ–‡ä»¶\"\n    echo \"         - å¤åˆ¶ webview èµ„æºæ–‡ä»¶ (HTML, JS) åˆ° dist/webview/ ç›®å½•\"\n    npm run bundle\n    echo \"         âœ… ä»£ç æ†ç»‘å®Œæˆ\"\n    echo \"\"\n\n    echo \"   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\"\n    echo \"   â”ƒ âœ… æ„å»ºå®Œæˆï¼æ‰€æœ‰æºä»£ç å·²ç¼–è¯‘å¹¶æ†ç»‘åˆ° dist/ ç›®å½•ä¸­                      â”ƒ\"\n    echo \"   â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\"\n    echo \"\"\nfi\n\nif [ \"$BUILD_ONLY\" = false ]; then\n    echo \"ğŸ“¦ æ­¥éª¤ 3: æ‰§è¡Œæ‰“åŒ…æµç¨‹\"\n    echo \"   åˆ›å»º VS Code æ‰©å±•åŒ… (Vsix æ–‡ä»¶)ï¼Œå‡†å¤‡å‘å¸ƒæˆ–å®‰è£…\"\n    echo \"\"\n\n    echo \"   â”œâ”€â”€ å­æ­¥éª¤ 3.1: å‡†å¤‡æ‰“åŒ…ç¯å¢ƒ...\"\n    echo \"         - éªŒè¯ package.json ä¸­çš„å¿…è¦å­—æ®µ\"\n    echo \"         - æ£€æŸ¥æ‰©å±•æ¸…å•æ–‡ä»¶\"\n    echo \"         - ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„èµ„æºæ–‡ä»¶å­˜åœ¨\"\n    echo \"         âœ… æ‰“åŒ…ç¯å¢ƒå‡†å¤‡å°±ç»ª\"\n    echo \"\"\n\n    echo \"   â”œâ”€â”€ å­æ­¥éª¤ 3.2: æ‰§è¡Œ vsce æ‰“åŒ…å‘½ä»¤...\"\n    echo \"         - æ”¶é›†æ‰€æœ‰è¦åŒ…å«åœ¨æ‰©å±•ä¸­çš„æ–‡ä»¶\"\n    echo \"         - ç”Ÿæˆæ‰©å±•æ¸…å•æ–‡ä»¶\"\n    echo \"         - åˆ›å»ºæœ€ç»ˆçš„ .vsix åŒ…æ–‡ä»¶\"\n    npm run package\n    echo \"\"\n\n    echo \"   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\"\n    echo \"   â”ƒ ğŸ‰ æ‰“åŒ…å®Œæˆï¼VS Code æ‰©å±•åŒ…å·²æˆåŠŸåˆ›å»º                                  â”ƒ\"\n    echo \"   â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\"\n    echo \"\"\n\n    # æ˜¾ç¤ºç”Ÿæˆçš„åŒ…æ–‡ä»¶\n    echo \"ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶è¯¦æƒ…:\"\n    ls -la yuangs-vscode-*.vsix\n    echo \"\"\n\n    echo \"ğŸ“‹ æ‰“åŒ…å†…å®¹æ‘˜è¦:\"\n    vsce ls | head -20\n    if [ $(vsce ls | wc -l) -gt 20 ]; then\n        echo \"   ... (æ˜¾ç¤ºå‰20ä¸ªé¡¹ç›®ï¼Œæ€»å…±$(vsce ls | wc -l)ä¸ªé¡¹ç›®)\"\n    fi\n    echo \"\"\n\n    echo \"ğŸ’¡ ä¸‹ä¸€æ­¥:\"\n    echo \"  1. åœ¨ VS Code ä¸­æŒ‰ F5 å¯åŠ¨è°ƒè¯•\"\n    echo \"  2. æˆ–è€…å®‰è£…ç”Ÿæˆçš„ VSIX æ–‡ä»¶è¿›è¡Œæµ‹è¯•: code --install-extension yuangs-vscode-*.vsix\"\n    echo \"  3. æˆ–è€…å‘å¸ƒåˆ° VS Code Marketplace\"\nelse\n    echo \"\"\n    echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"\n    echo \"âœ¨ æ„å»ºå®Œæˆï¼è·³è¿‡æ‰“åŒ…æ­¥éª¤ã€‚\"\n    echo \"\"\n    echo \"ğŸ’¡ æç¤º: ä½¿ç”¨ 'npm run package' å•ç‹¬æ‰§è¡Œæ‰“åŒ…\"\nfi\n\necho \"\"\necho \"ğŸ¯ æµç¨‹ç»“æŸ - æ‰€æœ‰æ­¥éª¤å·²å®Œæˆ\"\n\n",
    "id": "file:compile.sh",
    "tokens": 1160,
    "importance": 0.5,
    "lastUsedAt": 1769945760640
  },
  {
    "type": "file",
    "path": "/home/ubuntu/vsyuangs/src/runtime/vscode/VSCodeExecutor.ts",
    "content": "import * as vscode from 'vscode';\nimport * as path from 'path';\nimport { createIgnoreFilter } from '../../vscode/utils/ignoreFilter';\n\nexport class VSCodeExecutor {\n    private static ignoreFilter = createIgnoreFilter();\n    // å¤„ç†æ–‡ä»¶æ¸²æŸ“/é¢„è§ˆ\n    static async previewFile(filePath: string) {\n        const fullPath = path.isAbsolute(filePath)\n            ? filePath\n            : path.join(vscode.workspace.workspaceFolders?.[0].uri.fsPath || '', filePath);\n        const uri = vscode.Uri.file(fullPath);\n        await vscode.commands.executeCommand('vscode.open', uri);\n    }\n\n    // æ‰§è¡Œç»ˆç«¯å‘½ä»¤\n    static async runCommand(command: string): Promise<string> {\n        return new Promise((resolve) => {\n            const terminal = vscode.window.activeTerminal || vscode.window.createTerminal('Yuangs Agent');\n            terminal.show();\n            terminal.sendText(command);\n            // VS Code ç»ˆç«¯ä¸å®¹æ˜“ç›´æ¥è·å–è¾“å‡ºï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€\n            resolve(\"Command sent to VS Code terminal.\");\n        });\n    }\n\n    // åº”ç”¨æ–‡ä»¶ä¿®æ”¹\n    static async writeFile(filePath: string, content: string): Promise<string> {\n        const fullPath = this.getAbsolutePath(filePath);\n        const uri = vscode.Uri.file(fullPath);\n        await vscode.workspace.fs.writeFile(uri, Buffer.from(content));\n        return `File saved: ${filePath}`;\n    }\n\n    // è¯»å–æ–‡ä»¶å†…å®¹\n    static async readFile(filePath: string): Promise<string> {\n        const fullPath = this.getAbsolutePath(filePath);\n        const uri = vscode.Uri.file(fullPath);\n        const content = await vscode.workspace.fs.readFile(uri);\n        return Buffer.from(content).toString('utf8');\n    }\n\n    // åˆ—å‡ºç›®å½•æ–‡ä»¶\n    static async listFiles(dirPath: string = '.'): Promise<string> {\n        const fullPath = this.getAbsolutePath(dirPath);\n        const uri = vscode.Uri.file(fullPath);\n        const entries = await vscode.workspace.fs.readDirectory(uri);\n        \n        // Apply ignore filter if available\n        let filteredEntries = entries;\n        if (this.ignoreFilter) {\n            const workspaceRoot = vscode.workspace.workspaceFolders?.[0].uri.fsPath;\n            if (workspaceRoot) {\n                filteredEntries = entries.filter(([name, type]) => {\n                    const entryPath = path.join(fullPath, name);\n                    return !this.ignoreFilter!.shouldIgnore(entryPath, workspaceRoot);\n                });\n            }\n        }\n        \n        return filteredEntries.map(([name, type]) => `${name}${type === vscode.FileType.Directory ? '/' : ''}`).join('\\n');\n    }\n\n    // è·å–ç»å¯¹è·¯å¾„è¾…åŠ©æ–¹æ³•\n    private static getAbsolutePath(filePath: string): string {\n        if (path.isAbsolute(filePath)) {\n            return filePath;\n        }\n        const workspaceFolder = vscode.workspace.workspaceFolders?.[0].uri.fsPath;\n        if (!workspaceFolder) {\n            throw new Error(\"No workspace folder open.\");\n        }\n        return path.join(workspaceFolder, filePath);\n    }\n\n    // å¤„ç† Diff åº”ç”¨ (ä¸‰é˜¶æ®µæ‰§è¡Œï¼šPre-Exec / Exec / Post-Exec)\n    static async applyDiff(diff: string): Promise<string> {\n        const workspaceRoot = vscode.workspace.workspaceFolders?.[0].uri.fsPath;\n        if (!workspaceRoot) {\n            throw new Error(\"No workspace opened.\");\n        }\n\n        try {\n            // --- Phase 1: Pre-Exec (Snapshot/Validation) ---\n            const status = await this.execCommand(\"git status --porcelain\", workspaceRoot);\n            if (status.trim().length > 0) {\n                const choice = await vscode.window.showWarningMessage(\n                    \"Working tree is dirty. Apply diff anyway?\",\n                    { modal: true },\n                    \"Stash and Continue\", \"Abort\"\n                );\n                if (choice === \"Stash and Continue\") {\n                    await this.execCommand(\"git stash\", workspaceRoot);\n                } else {\n                    throw new Error(\"Execution aborted due to dirty working tree.\");\n                }\n            }\n\n            const preHash = (await this.execCommand(\"git rev-parse HEAD\", workspaceRoot)).trim();\n\n            // --- Phase 2: Exec (Application) ---\n            await this.execCommandWithInput(\"git apply --index\", diff, workspaceRoot);\n\n            // --- Phase 3: Post-Exec (Validation & Commit) ---\n            const changedFiles = (await this.execCommand(\"git diff --name-only HEAD\", workspaceRoot))\n                .trim()\n                .split(\"\\n\")\n                .filter(f => f.length > 0);\n\n            const commitMessage = `Agent: Applied semantic code change\\n\\n- Files: ${changedFiles.join(\", \")}`;\n            await this.execCommand(`git commit -m \"${commitMessage}\"`, workspaceRoot);\n\n            const postHash = (await this.execCommand(\"git rev-parse HEAD\", workspaceRoot)).trim();\n\n            vscode.window.showInformationMessage(`Successfully applied change: ${postHash.substring(0, 7)}`);\n\n            return `[SUCCESS] Applied 3-phase execution.\\n- Snapshot: ${preHash.substring(0, 7)}\\n- Commit: ${postHash.substring(0, 7)}\\n- Files: ${changedFiles.length}`;\n\n        } catch (error: any) {\n            vscode.window.showErrorMessage(`Diff failed: ${error.message}`);\n            // Rollback if possible (git reset --hard)\n            return `[FAILED] ${error.message}`;\n        }\n    }\n\n    private static async execCommand(command: string, cwd: string): Promise<string> {\n        const { exec } = require('child_process');\n        return new Promise((resolve, reject) => {\n            exec(command, { cwd }, (error: any, stdout: string, stderr: string) => {\n                if (error) reject(new Error(stderr || error.message));\n                else resolve(stdout);\n            });\n        });\n    }\n\n    private static async execCommandWithInput(command: string, input: string, cwd: string): Promise<string> {\n        const { exec } = require('child_process');\n        return new Promise((resolve, reject) => {\n            const child = exec(command, { cwd }, (error: any, stdout: string, stderr: string) => {\n                if (error) reject(new Error(stderr || error.message));\n                else resolve(stdout);\n            });\n            child.stdin.write(input);\n            child.stdin.end();\n        });\n    }\n}\n",
    "id": "file:/home/ubuntu/vsyuangs/src/runtime/vscode/VSCodeExecutor.ts",
    "tokens": 1549,
    "importance": 0.5,
    "lastUsedAt": 1769955068810
  }
]