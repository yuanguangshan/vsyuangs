[
  {
    "type": "file",
    "path": "compile.sh",
    "content": "#!/bin/bash\n\n# Yuangs VSCode Extension 一键编译和打包脚本\n# 自动查找 npm 并执行完整的构建和打包流程\n\nset -e\n\necho \"🔍 正在查找 Node.js 和 npm...\"\n\n# 尝试多种方式找到 node 和 npm\nNODE_BIN_DIR=\"\"\n\n# 方法1: 检查常见路径\nfor base_path in \\\n    \"/usr/local/bin\" \\\n    \"/opt/homebrew/bin\" \\\n    \"$HOME/.nvm/versions/node/*/bin\" \\\n    \"$HOME/.volta/bin\" \\\n    \"$HOME/.fnm/node-versions/*/installation/bin\"\ndo\n    # 展开通配符\n    for path in $base_path; do\n        if [ -d \"$path\" ] && [ -f \"$path/node\" ] && [ -f \"$path/npm\" ]; then\n            NODE_BIN_DIR=\"$path\"\n            break 2\n        fi\n    done\ndone\n\n# 方法2: 使用 which\nif [ -z \"$NODE_BIN_DIR\" ]; then\n    NODE_PATH=$(which node 2>/dev/null || echo \"\")\n    if [ -n \"$NODE_PATH\" ]; then\n        NODE_BIN_DIR=$(dirname \"$NODE_PATH\")\n    fi\nfi\n\nif [ -z \"$NODE_BIN_DIR\" ]; then\n    echo \"❌ 错误: 找不到 Node.js 和 npm\"\n    echo \"请确保已安装 Node.js 和 npm\"\n    echo \"\"\n    echo \"安装方式:\"\n    echo \"  - Homebrew: brew install node\"\n    echo \"  - NVM: https://github.com/nvm-sh/nvm\"\n    echo \"  - 官网: https://nodejs.org/\"\n    exit 1\nfi\n\n# 设置 PATH\nexport PATH=\"$NODE_BIN_DIR:$PATH\"\n\necho \"✅ 找到 Node.js: $NODE_BIN_DIR/node\"\necho \"✅ 找到 npm: $NODE_BIN_DIR/npm\"\necho \"\"\n\n# 显示版本信息\necho \"📦 Node.js 版本:\"\nnode --version\necho \"\"\necho \"📦 npm 版本:\"\nnpm --version\necho \"\"\n\n# 检查 vsce 是否已安装\necho \"\"\necho \"🔍 检查 vsce (VSCE 打包工具)...\"\nif ! command -v vsce &> /dev/null; then\n    echo \"⚠️  vsce 未找到，正在尝试安装...\"\n    npm install -g @vscode/vsce\n    if [ $? -ne 0 ]; then\n        echo \"❌ 安装 vsce 失败，请手动安装: npm install -g @vscode/vsce\"\n        exit 1\n    fi\nfi\necho \"✅ vsce 已安装: $(which vsce)\"\n\n# 进入项目目录\ncd \"$(dirname \"$0\")\"\n\n# 获取用户输入参数\nBUILD_ONLY=false\nPACKAGE_ONLY=false\nCLEAN_BUILD=false\n\nwhile [[ $# -gt 0 ]]; do\n    case $1 in\n        --build-only)\n            BUILD_ONLY=true\n            shift\n            ;;\n        --package-only)\n            PACKAGE_ONLY=true\n            shift\n            ;;\n        --clean)\n            CLEAN_BUILD=true\n            shift\n            ;;\n        *)\n            echo \"未知参数: $1\"\n            echo \"用法: $0 [--build-only | --package-only | --clean]\"\n            exit 1\n            ;;\n    esac\ndone\n\necho \"\"\necho \"🚀 开始构建和打包流程...\"\necho \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"\necho \"\"\n\nif [ \"$CLEAN_BUILD\" = true ]; then\n    echo \"🧹 步骤 1: 清理旧的构建文件...\"\n    echo \"   删除 dist/ 和 out/ 目录以确保干净的构建环境\"\n    rm -rf dist/\n    rm -rf out/\n    echo \"   ✅ 清理完成\"\n    echo \"\"\nfi\n\nif [ \"$PACKAGE_ONLY\" = false ]; then\n    echo \"🏗️  步骤 2: 执行完整构建流程\"\n    echo \"   此步骤将编译所有源代码并创建生产就绪的捆绑包\"\n    echo \"\"\n\n    echo \"   ├── 子步骤 2.1: 编译 AssemblyScript 代码...\"\n    echo \"         - 编译 src/engine/agent/governance/sandbox/core.as.ts 为 debug 和 release 版本\"\n    echo \"         - 生成 WebAssembly 模块供沙箱环境使用\"\n    npm run asbuild\n    echo \"         ✅ AssemblyScript 编译完成\"\n    echo \"\"\n\n    echo \"   ├── 子步骤 2.2: 捆绑和优化代码...\"\n    echo \"         - 使用 Webpack 将所有模块捆绑成单个 extension.js 文件\"\n    echo \"         - 复制 webview 资源文件 (HTML, JS) 到 dist/webview/ 目录\"\n    npm run bundle\n    echo \"         ✅ 代码捆绑完成\"\n    echo \"\"\n\n    echo \"   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\"\n    echo \"   ┃ ✅ 构建完成！所有源代码已编译并捆绑到 dist/ 目录中                      ┃\"\n    echo \"   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\"\n    echo \"\"\nfi\n\nif [ \"$BUILD_ONLY\" = false ]; then\n    echo \"📦 步骤 3: 执行打包流程\"\n    echo \"   创建 VS Code 扩展包 (Vsix 文件)，准备发布或安装\"\n    echo \"\"\n\n    echo \"   ├── 子步骤 3.1: 准备打包环境...\"\n    echo \"         - 验证 package.json 中的必要字段\"\n    echo \"         - 检查扩展清单文件\"\n    echo \"         - 确保所有必需的资源文件存在\"\n    echo \"         ✅ 打包环境准备就绪\"\n    echo \"\"\n\n    echo \"   ├── 子步骤 3.2: 执行 vsce 打包命令...\"\n    echo \"         - 收集所有要包含在扩展中的文件\"\n    echo \"         - 生成扩展清单文件\"\n    echo \"         - 创建最终的 .vsix 包文件\"\n    npm run package\n    echo \"\"\n\n    echo \"   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓\"\n    echo \"   ┃ 🎉 打包完成！VS Code 扩展包已成功创建                                  ┃\"\n    echo \"   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛\"\n    echo \"\"\n\n    # 显示生成的包文件\n    echo \"📁 生成的文件详情:\"\n    ls -la yuangs-vscode-*.vsix\n    echo \"\"\n\n    echo \"📋 打包内容摘要:\"\n    vsce ls | head -20\n    if [ $(vsce ls | wc -l) -gt 20 ]; then\n        echo \"   ... (显示前20个项目，总共$(vsce ls | wc -l)个项目)\"\n    fi\n    echo \"\"\n\n    echo \"💡 下一步:\"\n    echo \"  1. 在 VS Code 中按 F5 启动调试\"\n    echo \"  2. 或者安装生成的 VSIX 文件进行测试: code --install-extension yuangs-vscode-*.vsix\"\n    echo \"  3. 或者发布到 VS Code Marketplace\"\nelse\n    echo \"\"\n    echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"\n    echo \"✨ 构建完成！跳过打包步骤。\"\n    echo \"\"\n    echo \"💡 提示: 使用 'npm run package' 单独执行打包\"\nfi\n\necho \"\"\necho \"🎯 流程结束 - 所有步骤已完成\"\n\n",
    "id": "file:compile.sh",
    "tokens": 1160,
    "importance": 0.5,
    "lastUsedAt": 1769945760640
  }
]